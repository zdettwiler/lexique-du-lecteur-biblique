import { NextResponse } from 'next/server'
import { db } from '@/lib/db'

// const pegon = [
// 'אֹ֫הֶל',
// 'אֱדֹם',
// 'אֱלִישָׁע',
// 'אֱלֹהִים',
// 'אֱמֶת',
// 'אֱמֹרִי',
// 'אֱמוּנָה',
// 'אֲבִיגַל',
// 'אֲבִיגָיִל',
// 'אֲבִימֶ֫לֶךְ',
// 'אֲדָמָה',
// 'אֲדֹנִיָּהוּ',
// 'אֲדֹנָי',
// 'אֲחִיתֹ֫פֶל',
// 'אֲחַשְׁוֵרושׁ',
// 'אֲמָנָה',
// 'אֲנִי',
// 'אֲרוֹן',
// 'אֲשֶׁר',
// 'אֳנִיָּה',
// 'אִיּוֹב',
// 'אִישׁ',
// 'אֲנָשִׁים',
// 'אִישׁ בּ֫שֶׁת',
// 'אִם',
// 'אִמְרָה',
// 'אִשָּׁה',
// 'נָשִׁים',
// 'אֵחַר',
// 'אֵיךְ',
// 'אֵין',
// 'אֵיפֹה',
// 'אֵל',
// 'אֵלִיָּהוּ',
// 'אֵלִיָּה',
// 'אֵ֫לֶּה',
// 'אֶל־',
// 'אֵם',
// 'אֵ֫מֶר',
// 'אֵ֫צֶל',
// 'אֵשׁ',
// 'אֵת',
// 'אֶ֫בֶן',
// 'אֶבֶן הָעֶזֶר',
// 'אֶ֫דֶן',
// 'אֶזְרָח',
// 'אֶחָד',
// 'אֶלְיָקִים',
// 'אֶלְקָנָה',
// 'אֶפְרַיִם',
// 'אֶפְרָתִי',
// 'אֶפֶס',
// 'אֶ֫רֶץ',
// 'אֲרָצוֹת',
// 'אֶ֫רֶז',
// 'אַבְשָׁלוֹם',
// 'אַבְנֵר',
// 'אַבְרָהָם',
// 'אַדִּיר',
// 'אַהֲרֹן',
// 'אַחֲרוֹן',
// 'אַחֲרֵי',
// 'אַחֵר',
// 'אַחַר',
// 'אַיֵּה',
// 'אֵי',
// 'אַךְ',
// 'אַשְׁדּוֹד',
// 'אַשּׁוּר',
// 'אַתָּה',
// 'אָבַד',
// 'אָבָה',
// 'אָב',
// 'אָבוֹת',
// 'אָדָם',
// 'אָהַב',
// 'אָח',
// 'אַחִים',
// 'אָחוֹת',
// 'אֲחָיוֹת',
// 'אָיַב',
// 'אָכְלָה',
// 'אָכַל',
// 'אָמַר',
// 'אָנֶה',
// 'וָאָנָה',
// 'אָסַף',
// 'אָפָה',
// 'אָרַר',
// 'אָתוֹן',
// 'אֹהֵב',
// 'אֹ֫זֶן',
// 'אָזְנַ֫יִם',
// 'אוֹר',
// 'אור',
// 'אוֹת',
// 'אוֹ',
// 'אוֹיֵב',
// 'אוּלַי',
// 'בְּ',
// 'בְּכִירָה',
// 'בְּכִי',
// 'בְּנֵי־עַמּוֹן',
// 'בְּעֵ֫בֶר',
// 'בְּעַד',
// 'בַּעַד',
// 'בְּרִיחַ',
// 'בְּרִית',
// 'בְּשׂוֹר',
// 'בְּתוּאֵל',
// 'בִּגְלַל',
// 'בִּלְעָם',
// 'בִּלְעֲדֵי',
// 'בִּלְתִּי',
// 'בִּנְיָמִין',
// 'בִּקֵּשׁ',
// 'בֵּין',
// 'בֵּית סֹהַר',
// 'בֵּית־לֶ֫חֶם',
// 'בֵּן',
// 'בָּנִים',
// 'בֵּרֵךְ',
// 'בֶּ֫דֶק',
// 'בֶּן־עַמִּי',
// 'בַּ֫יִת',
// 'בָּתִּים',
// 'בַּעֲבוּר',
// 'בַּת',
// 'בָּנוֹת',
// 'בָּא',
// 'בוא',
// 'בָּבֶל',
// 'בָּחַר',
// 'בָּחוּר',
// 'בָּטַח',
// 'בָּכָה',
// 'בָּלָק',
// 'בָּנָה',
// 'בָּקָר',
// 'בָּרִיא',
// 'בָּרַח',
// 'בָּרוּךְ',
// 'בָּשָׂר',
// 'בֹּ֫קֶר',
// 'בֹּרַךְ',
// 'בֻּקַּשׁ',
// 'בּושׁ',
// 'בְּאֵר שֶׁ֫בַע',
// 'גְּבוּל',
// 'גְּרִזִּים',
// 'גִּבְעָה',
// 'גִּבּוֹר',
// 'גִּדַּל',
// 'גִּלְעָד',
// 'גִּלָּה',
// 'גֵּו',
// 'גֵּר',
// 'גֶּשֶׁם',
// 'גַּם',
// 'גַּן',
// 'גַּת',
// 'גָּאַל',
// 'גָּבַהּ',
// 'גָּד',
// 'גָּדוֹל',
// 'גָּלָה',
// 'גָּמָל',
// 'גָּנַב',
// 'גֹּבַהּ',
// 'גֻּלָּה',
// 'גּוֹי',
// 'גּוֹיִם',
// 'גָּר',
// 'גור',
// 'גיל',
// 'גָּל',
// 'גול',
// 'דְּבַשׁ',
// 'דְּבוֹרָה',
// 'דִּבֶּר',
// 'דֶּ֫לֶת',
// 'דְּלָתוֹת',
// 'דֶּ֫רֶךְ',
// 'דְּרָכִים',
// 'דַּי',
// 'דַּל',
// 'דַּלִּים',
// 'דַּ֫עַת',
// 'דָּבַר',
// 'דָּבָר',
// 'דְּבָרִים',
// 'דָּגוֹן',
// 'דָּוִד',
// 'דָּלַל',
// 'דָּם',
// 'דָּן',
// 'דָּנִאֵל',
// 'דָּנִיֵּאל',
// 'דָּרְיָוֶשׁ',
// 'דָּרַךְ',
// 'דָּרַשׁ',
// 'דֹּר',
// 'דּוֹר',
// 'דּוֹד',

// 'הֲפֵכָה',
// 'הִבְדִּיל',
// 'הִגְלָה',
// 'הִגְדִּיל',
// 'הִגִּיד',
// 'הִדַּכֵּא',
// 'הִטַּמֵּא',
// 'הִכְרִית',
// 'הִלֵּךְ',
// 'הִלֵּל',
// 'הִמְצִיא',
// 'הִמְלִיךְ',
// 'הִנֵּה',
// 'הִסְתַּתֵּר',
// 'הִפִּיל',
// 'הִצְטַדֵּק',
// 'הִצִּיב',
// 'הִצִּיג',
// 'הִצִּיעַ',
// 'הִצִּיק',
// 'הִצִּית',
// 'הִצִּיל',
// 'הִקְשָׁה',
// 'הִקְהִיל',
// 'הִקְרִיב',
// 'הִשְׁכִּים',
// 'הִשְׁבִּיעַ',
// 'הִשְׁחִית',
// 'הִשְׁמִיעַ',
// 'הִשְׁתַּכֵּר',
// 'הִשְׁכִּין',
// 'הִשְׂבִּיעַ',
// 'הִתְבּוֹנֵן',
// 'הִתְוַדָּה',
// 'הִתְוַדַּע',
// 'הִתְוַכַּח',
// 'הִתְרוֹנֵן',
// 'הִתְמַלֵּא',
// 'הִתְנַשֵּׂא',
// 'הִתְחַתֵּן',
// 'הִתְגַּלָּה',
// 'הִתְיָעֵץ',
// 'הִתְיַצֵּב',
// 'הִתְחַנֵּן',
// 'הִתְאַבֵּל',
// 'הִתְבָּרֵךְ',
// 'הִתְהַלֵּךְ',
// 'הִתְהַלֵּל',
// 'הִתְחַבֵּא',
// 'הִתְפָּקֵד',
// 'הִתְקַבֵּץ',
// 'הִתְקַדֵּשׁ',
// 'הִתְקוֹמֵם',
// 'הֵאִיר',
// 'הֵבִיא',
// 'הֵבֵר',
// 'הֵחֵל',
// 'הֵיטִיב',
// 'הֵיכָל',
// 'הֵילִיל',
// 'הֵימִין',
// 'הֵינִיק',
// 'הֵישִׁיר',
// 'הֵמִית',
// 'הֵסֵב',
// 'הֵקִים',
// 'הֵקַל',
// 'הֵרִים',
// 'הֵרִיעַ',
// 'הֵרַע',
// 'הֵשִׁיב',
// 'הֶאֱזִין',
// 'הֶבֶל',
// 'הֶחֱיָה',
// 'הֶעֱלָה',
// 'הֶעֱבִיר',
// 'הֶעֱמִיד',
// 'הֶרְאָה / הִרְאָה',
// 'הַרְבֵּה',
// 'הַר',
// 'הָגְלָה',
// 'הָיָה',
// 'הָלַךְ',
// 'הָמְלַךְ',
// 'הָעֳמַד',
// 'הָפְקַד',
// 'הָפַךְ',
// 'הָרַס',
// 'הָרַג',
// 'הָרָה',
// 'הֻחַל',
// 'הֻחַן',
// 'הֻלַּל',
// 'הֻסַב',
// 'הֻצַּב',
// 'הֻצַּג',
// 'הֻצַּע',
// 'הֻצַּק',
// 'הֻצַּל',
// 'הוֹשִׁיב',
// 'הוֹאִיל',
// 'הוֹבִישׁ',
// 'הוֹלִיךְ',
// 'הוֹצִיא',
// 'הוֹצִיק',
// 'הוֹרִיד',
// 'הוֹרִישׁ',
// 'הוּבָא',
// 'הוּצַר',
// 'הוּצָא',
// 'הוּקַם',
// 'הוּרַד',
// 'כְּ',
// 'כְּלִי (כֵּלִים)',
// 'כְּמוֹ',
// 'כְּנַעֲנִי',
// 'כְּנַעַן',
// 'כְּרוּב',
// 'כִּכָּר',
// 'כִּסֵּא',
// 'כִּפֶּר',
// 'כֵּן',
// 'כֶּבֶשׂ',
// 'כֶּסֶף',
// 'כֶּרֶם',
// 'כַּאֲשֶׁר',
// 'כַּף רֶגֶל',
// 'כַּשְׂדִּים',
// 'כָּבֵד',
// 'כָּבוֹד',
// 'כָּפַף',
// 'כָּרַת',
// 'כָּרַת בְּרִית',
// 'כָּתַב',
// 'כֹּה',
// 'כֹּהֵן',
// 'כֹּל',
// 'כֻּפַּר',
// 'כִּי',
// 'כּוֹבַע',
// 'לְ',
// 'לְבַד',
// 'לְלֹא / לְלוֹא',
// 'לְמַעַן',
// 'לִמֵּד',
// 'לִפְנֵי',
// 'לִקְרַאת',
// 'לֵב',
// 'לֵוִי',
// 'לֶחֶם',
// 'לַיְלָה',
// 'לָבָן',
// 'לָחַם',
// 'לָכִישׁ',
// 'לָמַד',
// 'לָמָה / לָמָּה / לָמֶה',
// 'לָן / לין / לון',
// 'לָפַת',
// 'לָקַח',
// 'לֹא',
// 'לֻמַּד',
// 'לֻקַּח',
// 'לוֹט',
// 'לוּחַ',
// 'מְאֹד',
// 'מְלָאכָה',
// 'מְלוֹא / מְלאֹ',
// 'מְלוּכָה',
// 'מְנַשֶּׁה',
// 'מְעַט / מְעָט',
// 'מְעָרָה',
// 'מְצַד',
// 'מִדְבָּר',
// 'מִהֵר',
// 'מִזְרָח',
// 'מִזְבֵּחַ',
// 'מִי',
// 'מִלְכָּה',
// 'מִלֵּא',
// 'מִנְחָה',
// 'מִן־',
// 'מִצְרִי',
// 'מִצְפָּה',
// 'מִצְרַיִם',
// 'מִצְוָה',
// 'מִקֵּצ',
// 'מִשְׁכָּן',
// 'מִשְׁפָּחָה',
// 'מִשְׁפָּט',
// 'מִתְלַקַּחַת',
// 'מֵאַיִן',
// 'מֵעִם',
// 'מֵצַח',
// 'מֵת',
// 'מֶלֶךְ',
// 'מֶמְשָׁלָה',
// 'מַאֲכָל',
// 'מַדּוּעַ',
// 'מַה / מָה / מֶה',
// 'מַטֶּה',
// 'מַיִם',
// 'מַכְאוֹב',
// 'מַלְכוּת',
// 'מַלְאָךְ',
// 'מַמְלָכָה',
// 'מַס',
// 'מַעֲשֶׂה',
// 'מָאַס',
// 'מָדַד',
// 'מָדַי',
// 'מָוֶת',
// 'מָחָר',
// 'מָכַר',
// 'מָלַךְ',
// 'מָצָא',
// 'מָקוֹם',
// 'מָשִׁיחַ',
// 'מָשַׁח',
// 'מָתַי',
// 'מֹשֶׁה',
// 'מֻלָּא',
// 'מוֹאָב',
// 'מוֹלֶדֶת',
// 'מוֹעֵד',
// 'מוֹקֵשׁ',
// 'נְאֻם',
// 'נְהָרִים',
// 'נְכָסִים',
// 'נְכֹה',
// 'נְקֵבָה',
// 'נִבְרַךְ',
// 'נִגְלָה',
// 'נִגְנַב',
// 'נִדְרַשׁ',
// 'נִחַם',
// 'נִכְבַּשׁ',
// 'נִכְרַת',
// 'נִכְתַּב',
// 'נִלְקַח',
// 'נִלְחַם',
// 'נִמְלַט',
// 'נִמְצָא',
// 'נִמְכַּר',
// 'נִסְמַךְ',
// 'נִצַּב',
// 'נִצַּת',
// 'נִצַל',
// 'נִקְבַּר',
// 'נִקְהַל',
// 'נִקְבַּץ',
// 'נִקְדַּשׁ',
// 'נִקְרָא',
// 'נִרְפָּא',
// 'נִשְׁבַּר',
// 'נִשְׁכַּח',
// 'נִשְׁבַּע',
// 'נִשְׁמַע',
// 'נִשְׁמַר',
// 'נִשְׁפַּט',
// 'נִתַּן',
// 'נֵר',
// 'נֶאֱכַל',
// 'נֶאֱמָן',
// 'נֶגֶד',
// 'נֶגֶב',
// 'נֶהֱרַג',
// 'נֶחְקַר',
// 'נֶחְמָד',
// 'נֶעֱבַד',
// 'נֶעֱזַב',
// 'נֶפֶשׁ',
// 'נֶשֶׁר',
// 'נַחֲלָה',
// 'נַחַל',
// 'נַעֲרָה',
// 'נַעַר',
// 'נַפְתָּלִי',
// 'נָא',
// 'נָבִיא',
// 'נָבַז',
// 'נָבַק',
// 'נָבַר',
// 'נָגִיד',
// 'נָגַע',
// 'נָגַשׁ',
// 'נָחָשׁ',
// 'נָחוֹר',
// 'נָטַשׁ',
// 'נָכוֹן',
// 'נָמַד',
// 'נָמַס',
// 'נָמַק',
// 'נָסַב',
// 'נָפַל',
// 'נָקַל',
// 'נָשַׁק',
// 'נָשָׂא',
// 'נָתַן',
// 'נָתָן',
// 'נֹחַ',
// 'נֹכַח',
// 'נוֹדַע',
// 'נוֹלַד',
// 'נוֹצַר',
// 'נוֹקַשׁ',
// 'נוֹרַשׁ',
// 'נוֹרָא',
// 'נוֹתַר',
// 'סְבִיבוֹת',
// 'סְדֹם',
// 'סִבֵּב',
// 'סִיחֹן',
// 'סִינַי',
// 'סִפֵּר',
// 'סֵפֶר',
// 'סַלָּח',
// 'סַנְחֵרִיב',
// 'סַף',
// 'סָבִיב',
// 'סָבַב',
// 'סָכָל',
// 'סָמַךְ',
// 'סָרִיס',
// 'סָר',
// 'סֻכָּה',
// 'סוֹבֵב',
// 'סוּס',
// 'עֶבֶד',
// 'עַיִן',
// 'עָשֶׁר',
// 'עֲבֹדָה',
// 'עֲטָרָה',
// 'עֲמָלֵק',
// 'עֲפֹלִים',
// 'עֲרָבָה',
// 'עִיר',
// 'עִם',
// 'עֵגֶל',
// 'עֵד',
// 'עֵדָה',
// 'עֵז',
// 'עֵמֶק',
// 'עֵץ',
// 'עֵשֶׂב',
// 'עֵשָׂו',
// 'עֵת',
// 'עֶצֶם',
// 'עַד',
// 'עַזְגָּד',
// 'עַי',
// 'עַכְבָּר',
// 'עַל',
// 'עַמּוּד',
// 'עַם',
// 'עַתָּה',
// 'עָבַד',
// 'עָבַר',
// 'עָוֹן',
// 'עָזַב',
// 'עָזַר',
// 'עָלַץ',
// 'עָלָה',
// 'עָמַד',
// 'עָנָן',
// 'עָנָה',
// 'עָנָו',
// 'עָפָר',
// 'עָשִׁיר',
// 'עָשָׂה',
// 'עֹבַדְיָהוּ',
// 'עֹל',
// 'עֹרֵב',
// 'עֹר',
// 'עוֹד',
// 'עוֹלָה',
// 'עוֹלָל',
// 'עוֹלָם',
// 'עוֹף',
// 'פְּלִשְׁתִּי',
// 'פְּנוּאֵל',
// 'פִּגֵּר',
// 'פִּתְאֹם',
// 'פֶּה',
// 'פֶּסֶל',
// 'פֶּרֶד',
// 'פֶּשַׁע',
// 'פַּדַּן אֲרָם',
// 'פַּח',
// 'פַּחַד',
// 'פַּךְ',
// 'פַּרְעֹה',
// 'פַּר',
// 'פַּת',
// 'פָּדָה',
// 'פָּנִים',
// 'פָּנָה',
// 'פָּסַל',
// 'פָּקַד',
// 'פָּרַץ',
// 'פֹּה',
// 'פּוֹטִיפַר',
// 'פְּרִי',
// 'פִּיכֹל',
// 'צְדָקָה',
// 'צֳרִי',
// 'צִדְקִיָּהוּ',
// 'צִוָּה',
// 'צִיּוֹן',
// 'צִעֵק',
// 'צֶדֶק',
// 'צֶלֶם',
// 'צַד',
// 'צַדִּיק',
// 'צָבָא',
// 'צָלַח',
// 'צָעִיר',
// 'צָעַק',
// 'צָפוֹן',
// 'צֹאן',
// 'צוּר',
// 'קֹדֶשׁ',
// 'קִדְרוֹן',
// 'קִדֵּשׁ',
// 'קִיֵּם',
// 'קִיר',
// 'קִנֵּא',
// 'קֵצ',
// 'קֶדֶם',
// 'קֶרֶשׁ',
// 'קַיִן',
// 'קָבַב',
// 'קָבַר',
// 'קָדַשׁ',
// 'קָדושׁ',
// 'קָהָל',
// 'קָטָן',
// 'קָלַל',
// 'קָם',
// 'קָנֶה',
// 'קָנָה',
// 'קָצֶה',
// 'קָרָא',
// 'קָרוֹב',
// 'קָשֶׁה',
// 'קֹרָא',
// 'קֻדַּשׁ',
// 'רְחוֹב',
// 'רְפָאִים',
// 'רַב',
// 'רַגְלַיִם',
// 'רַד',
// 'רַחַם',
// 'רַע',
// 'רַפָּא',
// 'רַק',
// 'רַת',
// 'רָאִי',
// 'רָאשׁ',
// 'רָבָה',
// 'רָחַק',
// 'רָעָה',
// 'רָפָא',
// 'רָקַע',
// 'רָשָׁע',
// 'רָשַׁע',
// 'רֹאשׁ',
// 'רֹחַב',
// 'רֹעֶה',
// 'רֹקַח',
// 'רֹשֶׁע',
// 'רְחוֹב',
// 'שְׁאֵלָה',
// 'שְׁבוּעָה',
// 'שְׁמָמָה',
// 'שְׁמֹנֶה',
// 'שָׂבַע',
// 'שָׂדֶה',
// 'שָׂפָה',
// 'שָׁאַל',
// 'שָׁבַע',
// 'שָׁמַע',
// 'שָׁנָה',
// 'שָׁרַת',
// 'שָׁרַף',
// 'שָׁרָה',
// 'שָׁתָה',
// 'שָׁתַף',
// 'שֶׁמֶשׁ',
// 'שֶׁקֶר',
// 'שֶׁרֶף',
// 'שֶׁרֶשׁ',
// 'שֶׁתֶף',
// 'שַׁבָּת',
// 'שַׁחַר',
// 'שַׁמָּה',
// 'שַׁנָּה',
// 'שַׁר',
// 'שָׁקֵט',
// 'תְּהוֹם',
// 'תְּפִלָּה',
// 'תְּרוּמָה',
// 'תְּשׁוּעָה',
// 'תַּלְמִיד',
// 'תַּנִּין',
// 'תָּוֶךְ',
// 'תָּמִים',
// 'תָּפֵל',
// 'תָּקַע',
// ]

function normalizeToOxia(input: string): string {
  const tonosToOxiaMap: Record<string, string> = {
    ά: 'ά', // U+03AC → U+1F71
    έ: 'έ',
    ή: 'ή',
    ί: 'ί',
    ό: 'ό',
    ύ: 'ύ',
    ώ: 'ώ'
  }

  const replaced = [...input.normalize('NFC')]
    .map((char) => tonosToOxiaMap[char] || char)
    .join('')

  return replaced
}

export async function GET(request, { params }: { params: { lemma: string } }) {
  let { lemma } = await params
  console.log(
    [...decodeURI(lemma)].map(
      (c) => `${c} (U+${c.codePointAt(0)!.toString(16).toUpperCase()})`
    )
  )
  lemma = normalizeToOxia(decodeURI(lemma))

  // const test = "בָּיַי  בָּיַי"
  // console.log([...test].map(c => `${c} (U+${c.codePointAt(0)!.toString(16).toUpperCase()})`))

  const match = await db.$queryRaw`
    SELECT *
    FROM "LLB"
    WHERE lemma = ${lemma}
    LIMIT 1;
  `
  // const words = [lemma]
  // for (const word of words) {
  //   try {
  //     let match = await db.$queryRaw`
  //       SELECT *
  //       FROM "LLBWord"
  //       WHERE lemma = ${word}
  //       LIMIT 1;
  //     `;

  //     if (!match) {
  //       match = await db.$queryRaw`
  //         SELECT *
  //         FROM "BibleWord"
  //         WHERE lemma = ${word}
  //         LIMIT 1;
  //       `;
  //     }

  // words.push({
  //   pegon: word,
  //   strong: match[0]?.strong
  // })

  // } catch (error) {
  //   // console.log(word, error)
  //   // words.push({})
  // }

  return NextResponse.json(
    {
      match
    },
    { status: 201 }
  )

  // try {
  //   // const words = await db.$queryRaw`
  //   //   UPDATE "LLBWord"
  //   //   SET lemma = ${lemma} COLLATE "C"
  //   //   WHERE strong = 'G1802';
  //   // `;
  //   // const words = await db.$queryRaw`
  //   //   SELECT *
  //   //   FROM "LLBWord"
  //   //   WHERE lemma = ${lemma} COLLATE "C"
  //   //   LIMIT 1;
  //   // `;
  //   const words = await db.lLBWord.findFirst({
  //     where: { lemma },
  //   })
  //   // console.log([...words[0].lemma].map(c => `${c} (U+${c.codePointAt(0)!.toString(16).toUpperCase()})`))

  //   return NextResponse.json({
  //     words
  //   }, { status: 201 })
  // } catch (error) {
  //   return NextResponse.json({
  //     msg: 'Oups! Il y a eu un problème!',
  //     error
  //   }, { status: 500 })
  // }
}
